# WARNING: Do not edit /var/lib/maas/dhcpd.conf yourself.  MAAS will
# overwrite any changes made there.  Instead, you can modify dhcpd.conf by
# using DHCP snippets over the API or through the web interface.

option arch code 93 = unsigned integer 16; # RFC4578
option path-prefix code 210 = text; #RFC5071

#
# Shorter lease time for PXE booting
#
class "PXE" {
   match if substring (option vendor-class-identifier, 0, 3) = "PXE";
   default-lease-time 30;
   max-lease-time 30;
}

#
# Define lease time globally (can be overriden globally or per subnet
# with a DHCP snippet)
#
default-lease-time 600;
max-lease-time 600;

#
# Global DHCP snippets
#
# No global DHCP snippets defined

#
# Bootloaders
#
if option arch = 00:00 {
    # pxe
    filename "pxelinux.0";
} elsif option arch = 00:07 {
    # uefi_amd64
    filename "bootx64.efi";
} elsif option arch = 00:09 {
    # uefi_amd64
    filename "bootx64.efi";
} elsif option arch = 00:0B {
    # uefi_arm64
    filename "grubaa64.efi";
} elsif option arch = 00:0C {
    # open-firmware_ppc64el
    filename "bootppc64.bin";
} elsif option arch = 00:0E {
    # powernv
    filename "pxelinux.0";
    option path-prefix "ppc64el/";
} else {
    # pxe
    filename "pxelinux.0";
}

#
# Failover Peers
#

#
# Networks
#
shared-network vlan-5001 {
    subnet 172.31.0.0 netmask 255.255.0.0 {
           ignore-client-uids true;
           next-server 172.31.0.1;
           option subnet-mask 255.255.0.0;
           option broadcast-address 172.31.255.255;
           option domain-name-servers 1.1.1.1;
           option domain-name "maas";
           option domain-search "maas";
           option routers 172.31.0.1;
           option ntp-servers 172.31.0.1;

           #
           # Subnet DHCP snippets
           #
           # Name: TESTIYMPÄRISTÖ Rack 1 Chassis 1 Management
           host bmc3__172.31.2.3 { 
           	hardware ethernet 08:00:38:3C:DB:12;
           	fixed-address 172.31.2.3;
           	option host-name "bmc3";
           }
           
           host bmc4__172.31.2.4 { 
           	hardware ethernet 08:00:38:3C:DE:42;
           	fixed-address 172.31.2.4;
           	option host-name "bmc4";
           }
           
           host bmc9__172.31.2.9 { 
           	hardware ethernet 08:00:38:3C:DB:06;
           	fixed-address 172.31.2.9;
           	option host-name "bmc9";
           }
           
           host bmc5__172.31.2.5 { 
           	hardware ethernet 08:00:38:3C:DB:00;
           	fixed-address 172.31.2.5;
           	option host-name "bmc5";
           }
           
           host bmc6__172.31.2.6 { 
           	hardware ethernet 08:00:38:3C:DB:EA;
           	fixed-address 172.31.2.6;
           	option host-name "bmc6";
           }
           
           host bmc71__172.31.2.71 { 
           	hardware ethernet 08:00:38:3C:DC:EC;
           	fixed-address 172.31.2.71;
           	option host-name "bmc71";
           }
           
           host bmc7__172.31.2.7 { 
           	hardware ethernet 08:00:38:3C:DC:B6;
           	fixed-address 172.31.2.7;
           	option host-name "bmc7";
           }
           
           host bmc8__172.31.2.8 { 
           	hardware ethernet 08:00:38:3C:DB:1E;
           	fixed-address 172.31.2.8;
           	option host-name "bmc8";
           }
           
           host bmc1__172.31.2.1 { 
           	hardware ethernet 08:00:38:3C:DD:46;
           	fixed-address 172.31.2.1;
           	option host-name "bmc1";
           }
           # Name: TESTIYMPÄRISTÖ Rack 2 Chassis 3 Management
           host bmc23__172.31.2.123 { 
           	hardware ethernet 08:00:38:3C:DB:CC;
           	fixed-address 172.31.2.23;
           	option host-name "bmc23";
           }
           
           host bmc24__172.31.2.124 { 
           	hardware ethernet 08:00:38:3C:DB:94;
           	fixed-address 172.31.2.24;
           	option host-name "bmc24";
           }
           
           host bmc25__172.31.2.125 { 
           	hardware ethernet 08:00:38:3C:DC:C8;
           	fixed-address 172.31.2.25;
           	option host-name "bmc25";
           }
           
           host bmc26__172.31.2.126 { 
           	hardware ethernet 08:00:38:3C:DB:72;
           	fixed-address 172.31.2.26;
           	option host-name "bmc26";
           }
           
           host bmc27__172.31.2.127 { 
           	hardware ethernet 08:00:38:3C:DC:1A;
           	fixed-address 172.31.2.27;
           	option host-name "bmc27";
           }
           
           host bmc28__172.31.2.128 { 
           	hardware ethernet 08:00:38:3C:DC:14;
           	fixed-address 172.31.2.28;
           	option host-name "bmc28";
           }
           
           host bmc29__172.31.2.129 { 
           	hardware ethernet 08:00:38:3C:DC:2C;
           	fixed-address 172.31.2.29;
           	option host-name "bmc29";
           }
           
           host bmc53__172.31.2.153 { 
           	hardware ethernet 08:00:38:3C:DB:60;
           	fixed-address 172.31.2.53;
           	option host-name "bmc53";
           }
           
           host bmc54__172.31.2.154{ 
           	hardware ethernet 08:00:38:3C:DB:F0;
           	fixed-address 172.31.2.54;
           	option host-name "bmc54";
           }
           # Name: TESTIYMPÄRISTÖ Rack 2 Chassis 3 Blades
           host blade23
           {
           hardware ethernet 08:00:38:3c:db:cd;
           fixed-address 172.31.100.23;
           option host-name "blade23";
           }
           
           host blade24
           {
           hardware ethernet 08:00:38:3c:db:95;
           fixed-address 172.31.100.24;
           option host-name "blade24";
           }
           
           host blade25
           {
           hardware ethernet 08:00:38:3c:dc:c9;
           fixed-address 172.31.100.25;
           option host-name "blade25";
           }
           
           host blade26
           {
           hardware ethernet 08:00:38:3c:db:73;
           fixed-address 172.31.100.26;
           option host-name "blade26";
           }
           
           host blade27
           {
           hardware ethernet 08:00:38:3c:dc:1b;
           fixed-address 172.31.100.27;
           option host-name "blade27";
           }
           
           host blade28
           {
           hardware ethernet 08:00:38:3c:dc:15;
           fixed-address 172.31.100.28;
           option host-name "blade28";
           }
           
           host blade29
           {
           hardware ethernet 08:00:38:3c:dc:2d;
           fixed-address 172.31.100.29;
           option host-name "blade29";
           }
           
           host blade53
           {
           hardware ethernet 08:00:38:3c:db:61;
           fixed-address 172.31.100.53;
           option host-name "blade53";
           }
           
           host blade54
           {
           hardware ethernet 08:00:38:3c:db:f1;
           fixed-address 172.31.100.54;
           option host-name "blade54";
           }
           pool {
              range 172.31.1.2 172.31.1.254;
           }
    }
}

#
# Hosts
#
# blade03-intel-enp5s0f0
host 08-00-38-3c-db-13 {
   #
   # Node DHCP snippets
   #
   # No DHCP snippets defined for host

   hardware ethernet 08:00:38:3c:db:13;
   fixed-address 172.31.1.0;
}
# blade23-intel-enp5s0f0
host 08-00-38-3c-db-cd {
   #
   # Node DHCP snippets
   #
   # No DHCP snippets defined for host

   hardware ethernet 08:00:38:3c:db:cd;
   fixed-address 172.31.0.238;
}
# blade71-nvidia-enp5s0f0
host 08-00-38-3c-dc-ed {
   #
   # Node DHCP snippets
   #
   # No DHCP snippets defined for host

   hardware ethernet 08:00:38:3c:dc:ed;
   fixed-address 172.31.0.255;
}
# bsuper2-eno1
host 90-b1-1c-25-34-c8 {
   #
   # Node DHCP snippets
   #
   # No DHCP snippets defined for host

   hardware ethernet 90:b1:1c:25:34:c8;
   fixed-address 172.31.0.1;
}

#
# Notify MAAS
#
on commit {
   set clhw = binary-to-ascii(16, 8, ":", substring(hardware, 1, 6));
   set clip = binary-to-ascii(10, 8, ".", leased-address);
   set cllt = binary-to-ascii(10, 32, "", encode-int(lease-time, 32));
   set clht = pick-first-value(option host-name, "(none)");
   execute(
       "/usr/sbin/maas-dhcp-helper", "notify",
       "--action", "commit", "--mac", clhw,
       "--ip-family", "ipv4", "--ip", clip,
       "--lease-time", cllt, "--hostname", clht,
       "--socket", "/var/lib/maas/dhcpd.sock");
}
on expiry {
   set clhw = binary-to-ascii(16, 8, ":", substring(hardware, 1, 6));
   set clip = binary-to-ascii(10, 8, ".", leased-address);
   execute(
       "/usr/sbin/maas-dhcp-helper", "notify",
       "--action", "expiry", "--mac", clhw,
       "--ip-family", "ipv4", "--ip", clip,
       "--socket", "/var/lib/maas/dhcpd.sock");
}
on release {
   set clhw = binary-to-ascii(16, 8, ":", substring(hardware, 1, 6));
   set clip = binary-to-ascii(10, 8, ".", leased-address);
   execute(
       "/usr/sbin/maas-dhcp-helper", "notify",
       "--action", "release", "--mac", clhw,
       "--ip-family", "ipv4", "--ip", clip,
       "--socket", "/var/lib/maas/dhcpd.sock");
}

omapi-port 7911;
key omapi_key {
    algorithm HMAC-MD5;
    secret "DP/3wDmOAG5TWcD1tZiS4z8QdpXb2JqxPAqrKs5eU5vTPnwjr9Nnj/StkmPDebTvGzijWSLlV6d/U5H4cgp+PA==";
};
omapi-key omapi_key;
